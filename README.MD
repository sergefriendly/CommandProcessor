# CommandProcessor

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏, —Ü–≤–µ—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –∏ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è embedded-—Å–∏—Å—Ç–µ–º –∏ –Ω–µ —Ç–æ–ª—å–∫–æ.**


**–ú–æ—â–Ω—ã–π –∏ –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –∫–æ–º–∞–Ω–¥ –¥–ª—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º (Embedded C++) —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏, —Ü–≤–µ—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –∏ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è.**

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —à–∞–±–ª–æ–Ω–Ω—ã–π –∫–ª–∞—Å—Å –Ω–∞ C++ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ (CLI). –û–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω —Å —É—á–µ—Ç–æ–º —Ä–∞–±–æ—Ç—ã –Ω–∞ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö (AVR) –∏ –Ω–∞ –ü–ö, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—é, —Ü–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥, –æ–±—Ä–∞–±–æ—Ç–∫—É escape-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π –∏ –ø–æ–∏—Å–∫ –∫–æ–º–∞–Ω–¥.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* **–ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å:** –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–∞ AVR (Arduino), —Ç–∞–∫ –∏ –Ω–∞ PC (Linux/Windows/MacOS).
* **–®–∞–±–ª–æ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω:** –†–∞–∑–º–µ—Ä—ã –±—É—Ñ–µ—Ä–æ–≤ –∏ –∏–Ω–¥–µ–∫—Å–æ–≤ –∑–∞–¥–∞—é—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏.
* **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è:** –ì–∏–±–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –≤—Ö–æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞ –∞—Ä–≥—É–º–µ–Ω—Ç—ã —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ä–µ–∂–∏–º–∞–º–∏.
* **–¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ANSI-—Ü–≤–µ—Ç–æ–≤ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –æ—Ç–ª–∞–¥–∫–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
* **–°–∏—Å—Ç–µ–º–∞ –∫–æ–º–∞–Ω–¥:** –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫ –∫–æ–º–∞–Ω–¥ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–∂–∏–¥–∞–µ–º—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.
* **–ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ:** –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ—Ö–æ–∂–∏—Ö –∫–æ–º–∞–Ω–¥ –ø–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–µ.
* **–≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤:** –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ escape-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π (\n, \t, \r –∏ –¥—Ä.).

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
### –ü—Ä–∏–º–µ—Ä 1. –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ Arduino

```C++
#include "CommandProcessor.h"
#include "io.h"
#include "utils.h"

using utils::i; // char* to int
using utils::d; // char* to double

// –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ (–±—É—Ñ–µ—Ä 64 –±–∞–π—Ç–∞, –∏–Ω–¥–µ–∫—Å –Ω–∞ 16 —Ç–æ–∫–µ–Ω–æ–≤)
CommandProcessor<64, 16> cli;

// –°–æ–∑–¥–∞—ë–º –ø—Ä–æ—Å—Ç—É—é —Ñ—É–Ω–∫—Ü–∏—é
void sayHello() {
  // cli[1] —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç
  io::println(io::YELLOW, "!!! ", cli[1], " !!!", io::NO);
}

// –°–æ–∑–¥–∞—ë–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –ø–æ –≤—ã–∏—Å–ª–µ–Ω–∏—é –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–≥–æ –∫–æ—Ä–Ω—è –º–µ—Ç–æ–¥–æ–º –ù—å—é—Ç–æ–Ω–∞-–†–∞—Ñ—Å–æ–Ω–∞ 
double NewtonRaphsonSqrt(double x, double initial_guess, double iterations, bool verbose = false) {
  // –ú–µ—Ç–æ–¥ –ù—å—é—Ç–æ–Ω–∞-–†–∞—Ñ—Å–æ–Ω–∞
  double result = initial_guess;
  for (int i = 0; i < iterations; ++i) {
    result = 0.5 * (result + x / result);
    if (verbose)
      io::cout << i << ": " << result << io::endl;
  }
  return result;
}

// –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–¥–∞—á–∏ –≤ –º–∞—Å—Å–∏–≤ –∫–æ–º–º–∞–Ω–¥
void sqrt() {
  int result = NewtonRaphsonSqrt( d(cli[1]), d(cli[2]), i(cli[3]) );
  io::println(io::ORANGE, result, io::NO);
}

// –û–±—ä—è–≤–ª—è–µ–º –º–∞—Å—Å–∏–≤ –∫–æ–º–∞–Ω–¥: {–ò–º—è, –§—É–Ω–∫—Ü–∏—è-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –ö–æ–ª-–≤–æ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤}
Command cmd[] = {
  {"say", sayHello, 1}, // –û–∂–∏–¥–∞–µ—Ç 1 –∞—Ä–≥—É–º–µ–Ω—Ç
  {"sqrt", sqrt, -1}, // –û–∂–∏–¥–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ –º–Ω–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, –Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—Å–µ–≥–æ 3
};

void setup() {
  io::init(115200); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Serial
  cli.setPrompt(">> ")
     .showWelcome()
     .setDebugMode(false); // –í–∫–ª—é—á–∞–µ–º –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
  cli.setCommands(cmd);
}

void loop() {
  cli.readInput(); // –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–µ —á—Ç–µ–Ω–∏–µ –∏–∑ Serial
}
```

### –ü—Ä–∏–º–µ—Ä 2. –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ –ü–ö
```C++
#include "CommandProcessor.h"
#include "io.h"
#include "utils.h"

using utils::d; // char* to double

CommandProcessor<64, 16> cli;

void half_sum() {
  double a = d(cli[1]);
  double b = d(cli[2]);
  double result = (a + b) / 2;
  io::println("The half-sum of ", a, " and ", b, " is ", io::BLUE, result, io::NO);
}

Command cmd[] = {
  {"hsum", half_sum, -1},
};

int main() {
  cli.run(cmd, false, ">>> "); // debugMode = false, prompt = ">>> "
  return 0;
}
```

### –õ–æ–≥–∏–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
–í —Å—Ç—Ä–æ–∫–µ

```C++
{"cmd", cmd, -1},
```
*```"cmd"```  ‚Äî —ç—Ç–æ –∏–º—è (–∏–ª–∏ –ø—Å–µ–≤–¥–æ–Ω–∏–º) –∫ —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫—É, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –∫ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–∂–Ω–æ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ;
*```cmd```    ‚Äî —Å–∞–º–∞ —Ñ—É–Ω–∫—Ü–∏—è-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫;
*```-1```     ‚Äî –æ–∂–∏–¥–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ ```expectedArgCount```.

–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –≤—ã—Ö–æ–¥–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Ä–∞–∑–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:

```text
"cmd arg1 arg2 arg3 arg4" ‚Üí ["cmd", "arg1 arg2 arg3 arg4"] –ø—Ä–∏ expectedArgCount = 1 ‚Üí –æ—Ç–¥–µ–ª—è–µ—Ç—Å—è —Ä–æ–≤–Ω–æ –æ–¥–Ω–æ —Å–ª–æ–≤–æ ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã, –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∏–¥—ë—Ç –æ–¥–Ω–∏–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º.
"cmd arg1 arg2 arg3 arg4" ‚Üí ["cmd", "arg1", "arg2 arg3 arg4"] –ø—Ä–∏ expectedArgCount = 2 ‚Üí –æ—Ç–¥–µ–ª—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ –∏ –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç, –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∏–¥—ë—Ç —Ç—Ä–µ—Ç—å–∏–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º.
"cmd arg1 arg2 arg3 arg4" ‚Üí ["cmd", "arg1", "arg2", "arg3 arg4"] –ø—Ä–∏ expectedArgCount = 3 ‚Üí –æ—Ç–¥–µ–ª—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ –∏ –ø–µ—Ä–≤—ã–π –∏ –≤—Ç–æ—Ä–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç—ã, –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∏–¥—ë—Ç —á–µ—Ç–≤—ë—Ä—Ç—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º.
–ò —Ç.–¥.
"cmd arg1 arg2 arg3 arg4" ‚Üí ["cmd arg1 arg2 arg3 arg4"] –ø—Ä–∏ expectedArgCount = 0 ‚Üí –Ω–µ –æ—Ç–¥–µ–ª—è–µ—Ç—Å—è –Ω–∏—á–µ–≥–æ, –Ω–æ –∫–æ–º–∞–Ω–¥–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è, –∏ –≤–º–µ—Å—Ç–µ —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ –ø–æ–¥–∞—ë—Ç—Å—è –∫–∞–∫ –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ.
"cmd arg1 arg2 arg3 arg4" ‚Üí ["cmd", "arg1", "arg2", "arg3", "arg4"] –ø—Ä–∏ expectedArgCount = -1 ‚Üí –æ—Ç–¥–µ–ª—è—é—Ç—Å—è –≤—Å–µ —Å–ª–æ–≤–∞, –ø–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ ‚Äî –∫–æ–º–∞–Ω–¥–∞, –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî –∞—Ä–≥—É–º–µ–Ω—Ç—ã.
```

–î–ª—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–∞—é—Ç—Å—è –≤ –∫–æ–º–ª–µ–∫—Å–µ, –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–µ—Ä, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```text
.
‚îú‚îÄ‚îÄ CommandProcessor.h  # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –∫–æ–º–∞–Ω–¥
‚îú‚îÄ‚îÄ index.h             # –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π/–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –±—É—Ñ–µ—Ä)
‚îú‚îÄ‚îÄ io.h                # –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ü–≤–µ—Ç–æ–≤ (ANSI)
‚îú‚îÄ‚îÄ internal.h          # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ-–∑–∞–≤–∏—Å–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (AVR/PC)
‚îú‚îÄ‚îÄ utils.h             # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã (—Å—Ç—Ä–æ–∫–∏, –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞)
‚îî‚îÄ‚îÄ examples/           # –ü–∞–ø–∫–∞ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å)
```

## –°–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø–æ–≤–µ—Ä—Ö –ª—é–±—ã—Ö —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ—ë –∏–¥–µ–∞–ª—å–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º –¥–ª—è IoT-—É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏ —Å–∏—Å—Ç–µ–º —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

| –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å	| –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å |	–°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
|---|---|---|
| UART/Serial |	‚úÖ –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞	| –õ–æ–∫–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º |
| WiFi (TCP/IP) |	üîÑ –ì–æ—Ç–æ–≤–∞ –∫ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ |	–£–¥–∞–ª–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ —Å–µ—Ç–∏ |
| Ethernet |	üîÑ –ì–æ—Ç–æ–≤–∞ –∫ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏	–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã, —Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ |
| Bluetooth SPP |	üîÑ –ì–æ—Ç–æ–≤–∞ –∫ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ |	–ú–æ–±–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å smartphones |
